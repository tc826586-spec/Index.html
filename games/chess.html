<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>2D Chess – Legal Moves</title>
<style>
body{
  margin:0;
  background:#000;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  color:white;
  font-family:Arial;
}
#game{
  text-align:center;
}
#board{
  display:grid;
  grid-template-columns:repeat(8,70px);
  border:3px solid #00ffff;
}
.square{
  width:70px;
  height:70px;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:40px;
  cursor:pointer;
}
.light{background:#f0d9b5;}
.dark{background:#b58863;}
.hint{outline:4px solid #00ff00;}
.selected{outline:4px solid cyan;}
button{
  margin:10px;
  padding:8px 16px;
  background:#00e5ff;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
</style>
</head>

<body>
<div id="game">
  <h2>2D Chess</h2>
  <div id="board"></div>
  <button onclick="restart()">Restart</button>
  <button onclick="toggleAI()">AI: <span id="ai">ON</span></button>
</div>

<script>
const pieces={
  r:"♜",n:"♞",b:"♝",q:"♛",k:"♚",p:"♟",
  R:"♖",N:"♘",B:"♗",Q:"♕",K:"♔",P:"♙"
};

let board,turn="white",selected=null,hints=[],ai=true;

function restart(){
board=[
["r","n","b","q","k","b","n","r"],
["p","p","p","p","p","p","p","p"],
[".",".",".",".",".",".",".","."],
[".",".",".",".",".",".",".","."],
[".",".",".",".",".",".",".","."],
[".",".",".",".",".",".",".","."],
["P","P","P","P","P","P","P","P"],
["R","N","B","Q","K","B","N","R"]
];
turn="white";selected=null;hints=[];
draw();
}
restart();

function draw(){
const b=document.getElementById("board");
b.innerHTML="";
for(let r=0;r<8;r++){
for(let c=0;c<8;c++){
const s=document.createElement("div");
s.className="square "+((r+c)%2?"dark":"light");
if(selected&&selected.r===r&&selected.c===c)s.classList.add("selected");
if(hints.some(m=>m.r===r&&m.c===c))s.classList.add("hint");
s.textContent=pieces[board[r][c]]||"";
s.onclick=()=>click(r,c);
b.appendChild(s);
}}}

function click(r,c){
const p=board[r][c];
if(selected){
if(hints.some(m=>m.r===r&&m.c===c)){
move(selected.r,selected.c,r,c);
return;
}}
if(p===".")return;
if(turn==="white"&&p===p.toUpperCase()||
   turn==="black"&&p===p.toLowerCase()){
selected={r,c};
hints=getLegalMoves(r,c);
draw();
}}

function move(r1,c1,r2,c2){
board[r2][c2]=board[r1][c1];
board[r1][c1]=".";
selected=null;hints=[];
turn=turn==="white"?"black":"white";
draw();
if(ai&&turn==="black")setTimeout(aiMove,300);
}

function toggleAI(){
ai=!ai;
document.getElementById("ai").textContent=ai?"ON":"OFF";
}

function aiMove(){
let moves=[];
for(let r=0;r<8;r++)for(let c=0;c<8;c++){
if(board[r][c]===board[r][c].toLowerCase()){
getLegalMoves(r,c).forEach(m=>{
moves.push({r,c,m});
});
}}
if(moves.length){
let x=moves[Math.floor(Math.random()*moves.length)];
move(x.r,x.c,x.m.r,x.m.c);
}
}

function getLegalMoves(r,c){
return getMoves(r,c).filter(m=>!kingInCheckAfter(r,c,m.r,m.c));
}

function kingInCheckAfter(r1,c1,r2,c2){
const copy=board.map(x=>x.slice());
copy[r2][c2]=copy[r1][c1];
copy[r1][c1]=".";
return isKingInCheck(copy,copy[r2][c2]===copy[r2][c2].toUpperCase());
}

function isKingInCheck(b,white){
let kr,kc;
for(let r=0;r<8;r++)for(let c=0;c<8;c++){
if(b[r][c]===(white?"K":"k")){kr=r;kc=c;}
}
for(let r=0;r<8;r++)for(let c=0;c<8;c++){
const p=b[r][c];
if(p!=="."&&((p===p.toUpperCase())!==white)){
if(getMoves(r,c,b,true).some(m=>m.r===kr&&m.c===kc))
return true;
}}
return false;
}

function getMoves(r,c,b=board,attack=false){
const p=b[r][c];
const white=p===p.toUpperCase();
let m=[];
const dir=white?-1:1;

if(p.toLowerCase()==="p"){
if(!attack&&b[r+dir]?.[c]==="."){
m.push({r:r+dir,c});
if((white&&r===6||!white&&r===1)&&b[r+2*dir][c]===".")
m.push({r:r+2*dir,c});
}
[-1,1].forEach(dc=>{
if(b[r+dir]?.[c+dc]!==undefined&&b[r+dir][c+dc]!=="."&&
((b[r+dir][c+dc]===b[r+dir][c+dc].toUpperCase())!==white))
m.push({r:r+dir,c:c+dc});
});
}

const slide=(dirs)=>{
dirs.forEach(d=>{
let rr=r+d[0],cc=c+d[1];
while(b[rr]?.[cc]){
if(b[rr][cc]==="."){m.push({r:rr,c:cc});}
else{
if((b[rr][cc]===b[rr][cc].toUpperCase())!==white)
m.push({r:rr,c:cc});
break;
}
rr+=d[0];cc+=d[1];
}});
};

if("rbq".includes(p.toLowerCase())){
if("rq".includes(p.toLowerCase()))slide([[1,0],[-1,0],[0,1],[0,-1]]);
if("bq".includes(p.toLowerCase()))slide([[1,1],[1,-1],[-1,1],[-1,-1]]);
}

if(p.toLowerCase()==="n"){
[[1,2],[2,1],[-1,2],[-2,1],[1,-2],[2,-1],[-1,-2],[-2,-1]]
.forEach(d=>{
const rr=r+d[0],cc=c+d[1];
if(b[rr]?.[cc]!==undefined&&
(b[rr][cc]==="."||((b[rr][cc]===b[rr][cc].toUpperCase())!==white)))
m.push({r:rr,c:cc});
});
}

if(p.toLowerCase()==="k"){
for(let dr=-1;dr<=1;dr++)for(let dc=-1;dc<=1;dc++){
if(dr||dc){
const rr=r+dr,cc=c+dc;
if(b[rr]?.[cc]!==undefined&&
(b[rr][cc]==="."||((b[rr][cc]===b[rr][cc].toUpperCase())!==white)))
m.push({r:rr,c:cc});
}}
}
return m;
}
</script>
</body>
</html>
